"use strict";var R=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var z=(r,e)=>{for(var t in e)R(r,t,{get:e[t],enumerable:!0})},O=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of D(e))!j.call(r,s)&&s!==t&&R(r,s,{get:()=>e[s],enumerable:!(n=q(e,s))||n.enumerable});return r};var B=r=>O(R({},"__esModule",{value:!0}),r);var W={};z(W,{MTGA:()=>_});module.exports=B(W);var y=function(r,e){let t=r.selectionStart>r.selectionEnd,n=Math.min(r.selectionStart,r.selectionEnd),s=Math.max(r.selectionStart,r.selectionEnd),i=r.selectionDirection;return e?{isReversed:t,short:n,long:s,dir:i,value:r.value}:{isReversed:t,short:n,long:s,dir:i}},p=function(r,e){e.value&&(r.value=e.value),e.isReversed?r.setSelectionRange(e.long,e.short,e.dir||"none"):r.setSelectionRange(e.short,e.long,e.dir||"none"),r.focus()},S=function(r){let e=r.key,t=r.altKey,n=r.shiftKey,s=r.ctrlKey||r.metaKey;return{key:e,altKey:t,shiftKey:n,ctrlKey:s}};function A(r,e){let t=Array.from({length:r.length+1},()=>Array(e.length+1).fill(0));for(let c=1;c<=r.length;c++)for(let u=1;u<=e.length;u++)r[c-1]===e[u-1]?t[c][u]=t[c-1][u-1]+1:t[c][u]=Math.max(t[c-1][u],t[c][u-1]);let n=[],s=0,i=r.length,a=e.length,l=null,o=[],h=function(){l!==null&&o.length>0&&n.push([l,o.reverse().join("")]),l=null,o=[]};for(;i>0||a>0;){let c=r[i-1],u=e[a-1];i>0&&a>0&&c===u?(l!==0&&h(),l=0,o.push(c),s++,i--,a--):a>0&&(i===0||t[i][a-1]>=t[i-1][a])?(l!==1&&h(),l=1,o.push(u),a--):i>0&&(l!==-1&&h(),l=-1,o.push(c),i--)}return h(),{accuracy:s*2/(r.length+e.length),score:s,match:n.reverse()}}function L(r){let e=[],t=r.length;for(let n=1;n<1<<t;n++){let s=[];for(let i=0;i<t;i++)n>>i&1&&s.push(r[i]);e.push(s)}return e}var b=function(r){let{short:e,long:t}=y(r),n=r.value.split(/\n/),s=[],i=[],a=0;for(let l=0;l<n.length;l++){let o=n[l],c=l===n.length-1?o:o+`
`,u=a,f=a+o.length+1,d=-1,g=-1,m="";e>=u&&e<f&&(d=e-u),t>u&&t<f&&(g=t-u),e<=u&&t>=f&&(d=0,g=c.length),d>-1&&g===-1&&(g=c.length),g>-1&&d===-1&&(d=0);let v=d>-1&&g>-1;v&&(m=c.substring(d,g));let x={rowIndex:l,startIndex:u,endIndex:f,value:c,selectionStart:d,selectionEnd:g,selectionValue:m};s.push(x),v&&i.push(x),a=f}return{rows:s,selectedRows:i}},I=function(r,e,t){let{short:n,long:s,dir:i,isReversed:a}=y(r),l=n,o=s,h=[];for(let c of e){let{startIndex:u,endIndex:f}=c,d=c.value,g=t(c),m=g.length-d.length;n>=u&&n<f?m>=0?(l+=m,o+=m):(l+=Math.max(m,u-n),o+=Math.max(m,u-s)):s>=u&&n<f?m>=0?o+=m:o+=Math.max(m,u-s):o+=m,h.push(g)}return{isReversed:a,short:l,long:o,dir:i,value:h.join("")}};var C=function(r,e){return Object.keys(r).includes(e)};var P=function(r,e){return r[e]},w=class{element;pairs;constructor(e,t){this.element=e,this.pairs=t}isInsert(e){let{key:t,altKey:n,ctrlKey:s,shiftKey:i}=S(e);return!n&&!s&&C(this.pairs,t)}isDelete(e){let t=this.element,n=this.pairs,{key:s,altKey:i,ctrlKey:a,shiftKey:l}=S(e);if(i||a||l||s!=="Backspace")return!1;let{short:o,long:h,dir:c,isReversed:u}=y(t);if(o!==h)return!1;let d=t.value.charAt(h-1),g=t.value.charAt(h);return C(n,d)&&P(n,d)===g}insert(e){let t=this.element,n=this.pairs,{key:s}=S(e),{short:i,long:a,dir:l,isReversed:o}=y(t),h=i!==a,c=s,u=P(n,c),f=t.value.substring(0,i),d=t.value.substring(i,a),g=t.value.substring(a),m,v,x;if(h)x=f+c+d+u+g,m=(f+c).length,v=(f+c+d).length;else{let H=(f+c).length;x=f+c+u+g,m=H,v=H}p(t,{isReversed:o,short:m,long:v,dir:l,value:x})}delete(e){let t=this.element,n=this.pairs,{long:s}=y(t),i=t.value.substring(0,s-1),a=t.value.substring(s+1),l=i+a,o=i.length,h=i.length;p(t,{isReversed:!1,short:o,long:h,dir:"forward",value:l})}};var M=function(r){let{key:e,altKey:t,ctrlKey:n,shiftKey:s}=S(r);return n&&!s&&e.toLowerCase()==="z"},V=function(r){let{key:e,altKey:t,ctrlKey:n,shiftKey:s}=S(r);return n&&s&&e.toLowerCase()==="z"},K=class{element;histories;index;maxCount;constructor(e){this.element=e,this.histories=[],this.index=1,this.maxCount=390}prune(){this.index>1&&(this.histories=this.histories.slice(0,this.histories.length-(this.index-1)),this.index=1)}add(e=!0){let t=this.element;if(e)this.prune();else if(this.index!==1)return;let n=y(t,!0);this.histories.push(n),this.histories.length>this.maxCount&&this.histories.shift()}prev(){this.index<this.histories.length&&(this.index+=1)}next(){this.index>1&&(this.index-=1)}curr(){return this.histories[this.histories.length-this.index]}undo(e){let t=this.element;this.prev();let n=this.curr();n&&p(t,n)}redo(e){let t=this.element;this.next();let n=this.curr();n&&p(t,n)}};var U=function(r){for(let e of r)if(e.value.startsWith("//"))return!0;return!1},k=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="/",this.removePattern=/^\/\/\s?/,this.newValue="// "}isValid(e){let{key:t,altKey:n,shiftKey:s}=e;return(e.ctrlKey||e.metaKey)&&!n&&!s&&t===this.key}exec(e){let t=this.element,{rows:n,selectedRows:s}=b(t),i=s.length>1,a=U(s),l=I(t,n,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(i){let c=!o.value.trim();return a?o.value.replace(this.removePattern,""):c?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});p(t,l)}};var E=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="Tab",this.removePattern=/^[^\S\n\r][^\S\n\r]?/,this.newValue="  "}isValid(e){let{key:t,altKey:n,shiftKey:s}=e;return!(e.ctrlKey||e.metaKey)&&!n&&t===this.key}exec(e){let t=this.element,{rows:n,selectedRows:s}=b(t),i=s.length>1,a=e.shiftKey,l=I(t,n,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(i){let c=!o.value.trim();return a?o.value.replace(this.removePattern,""):c?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});p(t,l)}};var T=class{element;tags;index;timeout;result;parser;filter;onData;onEnd;_reqId;_chunkSize;_state;_stop;constructor(e){this.element=e,this.tags=[],this.index={},this.timeout=0,this.result=[],this.parser=t=>{let n=t.value.split(/[,.․‧・｡。{}()<>[\]\\/|'"`!?]|\r\n|\r|\n/),s=t.selectionStart,i=0,a=0;for(let c of n){if(a=i+c.length,s>=i&&s<=a)break;i=a+1}let l=t.value.substring(0,i),o=t.value.substring(i,a).trim(),h=t.value.substring(a);return{head:l,body:o,tail:h}},this.filter=()=>!0,this.onData=()=>{},this.onEnd=()=>{},this._reqId=0,this._chunkSize=100,this._state=y(e,!0),this._stop=()=>{}}findIndex(e){let t=this.index,n=Object.keys(t).sort((s,i)=>i.length-s.length);for(let s of n){let{score:i}=A(s,e);if(i===s.length)return t[s]}}createIndex(e){let t=this.tags,n=this.index;return this.index=n,new Promise(s=>{let i=0,a=()=>{let l=i+100;for(;i<t.length;){if(i>=l){setTimeout(a,0);return}let o=t[i],h=[],c=L(o.key.split(""));for(let f of c){let d=f.join("");d.length===e&&h.push(d)}let u=[...new Set(h)];for(let f of u)n[f]?n[f].push(o):n[f]=[o];i++}s(n)};a()})}compare(e,t){return A(e,t)}stop(e){let t=this._stop;t?.(e)}reset(){p(this.element,this._state)}set(e){let t=e.parts.head.length+e.tag.value.length,n=e.parts.head.length+e.tag.value.length,s=e.parts.head+e.tag.value+e.parts.tail,i={short:t,long:n,value:s};p(this.element,i)}exec(){this.stop(!0);let e=this._reqId+1,t=this._chunkSize,n=Date.now(),s=[],i=!1,a=!1,l=0,o=d=>{i=!0,a=d||!1};this.result=s,this._state=y(this.element,!0),this._reqId=e,this._stop=o;let h=this.parser(this.element),c=h.body,u=c?this.findIndex(c)||this.tags:[],f=()=>{let d=[],g=l+t;for(;l<g&&l<u.length;){let v={tag:u[l],parts:h};this.filter(v,l,u)&&(d.push(v),s.push(v)),l++}if(!(a||this._reqId!==e)){if(i||l>=u.length||this.timeout&&Date.now()-n>=this.timeout){this.onData?.(d),this.onEnd?.(s);return}this.onData?.(d),setTimeout(f,0)}};f()}};var _=class{element;_keydownState;History;Commentify;Indentify;AutoPairing;AutoComplete;constructor(e){this.element=e,this._keydownState=null,this.History=new K(e),this.Commentify=new k(e),this.Indentify=new E(e),this.AutoPairing=new w(e,{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}),this.AutoComplete=new T(e),e.addEventListener("keydown",t=>{M(t)?(t.preventDefault(),this.History.undo(t),this._clearKeydownState()):V(t)?(t.preventDefault(),this.History.redo(t),this._clearKeydownState()):this.AutoPairing.isInsert(t)?(t.preventDefault(),this.AutoPairing.insert(t),this.History.add(),this._clearKeydownState()):this.AutoPairing.isDelete(t)?(t.preventDefault(),this.AutoPairing.delete(t),this.History.add(),this._clearKeydownState()):this.Commentify.isValid(t)?(t.preventDefault(),this.Commentify.exec(t),this.History.add(),this._clearKeydownState()):this.Indentify.isValid(t)?(t.preventDefault(),this.Indentify.exec(t),this.History.add(),this._clearKeydownState()):["Meta","Control","Alt","Shift"].includes(t.key)||this._setKeydownState(t)},!0),e.addEventListener("keyup",t=>{let n=this._keydownState;if(this._clearKeydownState(),!n)return;if(n.value!==e.value)this.History.add();else{let i=n.state,a=y(e);(i.short!==a.short||i.long!==a.long)&&this.History.add(!1)}},!0),e.addEventListener("keyup",t=>{let{metaKey:n,ctrlKey:s,key:i}=t;!n&&!s&&(i.length===1||i==="Backspace")&&this.AutoComplete.exec()},!0),this.element.addEventListener("mouseup",t=>{this.History.add(!1)},!0)}getState(e){return y(this.element,e)}setState(e){p(this.element,e)}_clearKeydownState(){this._keydownState=null}_setKeydownState(e){this._keydownState={value:this.element.value,state:y(this.element),key:e.key}}};
