"use strict";var k=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var O=(n,e)=>{for(var t in e)k(n,t,{get:e[t],enumerable:!0})},B=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of D(e))!q.call(n,r)&&r!==t&&k(n,r,{get:()=>e[r],enumerable:!(s=j(e,r))||s.enumerable});return n};var U=n=>B(k({},"__esModule",{value:!0}),n);var J={};O(J,{MTGA:()=>C});module.exports=U(J);var y=function(n,e){let t=n.selectionStart>n.selectionEnd,s=Math.min(n.selectionStart,n.selectionEnd),r=Math.max(n.selectionStart,n.selectionEnd),i=n.selectionDirection;return e?{isReversed:t,short:s,long:r,dir:i,value:n.value}:{isReversed:t,short:s,long:r,dir:i}},p=function(n,e){e.value&&(n.value=e.value),e.isReversed?n.setSelectionRange(e.long,e.short,e.dir||"none"):n.setSelectionRange(e.short,e.long,e.dir||"none"),n.focus()},x=function(n){let e=n.key,t=n.altKey,s=n.shiftKey,r=n.ctrlKey||n.metaKey;return{key:e,altKey:t,shiftKey:s,ctrlKey:r}};function A(n,e){let t=Array.from({length:n.length+1},()=>Array(e.length+1).fill(0));for(let l=1;l<=n.length;l++)for(let h=1;h<=e.length;h++)n[l-1]===e[h-1]?t[l][h]=t[l-1][h-1]+1:t[l][h]=Math.max(t[l-1][h],t[l][h-1]);let s=[],r=0,i=n.length,a=e.length,c=null,o=[],u=function(){c!==null&&o.length>0&&s.push([c,o.reverse().join("")]),c=null,o=[]};for(;i>0||a>0;){let l=n[i-1],h=e[a-1];i>0&&a>0&&l===h?(c!==0&&u(),c=0,o.push(l),r++,i--,a--):a>0&&(i===0||t[i][a-1]>=t[i-1][a])?(c!==1&&u(),c=1,o.push(h),a--):i>0&&(c!==-1&&u(),c=-1,o.push(l),i--)}return u(),{accuracy:r*2/(n.length+e.length),score:r,match:s.reverse()}}function _(n){let e=[],t=n.length;for(let s=1;s<1<<t;s++){let r=[];for(let i=0;i<t;i++)s>>i&1&&r.push(n[i]);e.push(r)}return e}var b=function(n){let{short:e,long:t}=y(n),s=n.value.split(/\n/),r=[],i=[],a=0;for(let c=0;c<s.length;c++){let o=s[c],l=c===s.length-1?o:o+`
`,h=a,g=a+o.length+1,d=-1,f=-1,m="";e>=h&&e<g&&(d=e-h),t>h&&t<g&&(f=t-h),e<=h&&t>=g&&(d=0,f=l.length),d>-1&&f===-1&&(f=l.length),f>-1&&d===-1&&(d=0);let v=d>-1&&f>-1;v&&(m=l.substring(d,f));let S={rowIndex:c,startIndex:h,endIndex:g,value:l,selectionStart:d,selectionEnd:f,selectionValue:m};r.push(S),v&&i.push(S),a=g}return{rows:r,selectedRows:i}},I=function(n,e,t){let{short:s,long:r,dir:i,isReversed:a}=y(n),c=s,o=r,u=[];for(let l of e){let{startIndex:h,endIndex:g}=l,d=l.value,f=t(l),m=f.length-d.length;s>=h&&s<g?m>=0?(c+=m,o+=m):(c+=Math.max(m,h-s),o+=Math.max(m,h-r)):r>=h&&s<g?m>=0?o+=m:o+=Math.max(m,h-r):o+=m,u.push(f)}return{isReversed:a,short:c,long:o,dir:i,value:u.join("")}};var H=function(n,e){return Object.keys(n).includes(e)};var P=function(n,e){return n[e]},K=class{element;pairs;constructor(e,t){this.element=e,this.pairs=t}isInsert(e){let{key:t,altKey:s,ctrlKey:r,shiftKey:i}=x(e);return!s&&!r&&H(this.pairs,t)}isDelete(e){let t=this.element,s=this.pairs,{key:r,altKey:i,ctrlKey:a,shiftKey:c}=x(e);if(i||a||c||r!=="Backspace")return!1;let{short:o,long:u,dir:l,isReversed:h}=y(t);if(o!==u)return!1;let d=t.value.charAt(u-1),f=t.value.charAt(u);return H(s,d)&&P(s,d)===f}insert(e){let t=this.element,s=this.pairs,{key:r}=x(e),{short:i,long:a,dir:c,isReversed:o}=y(t),u=i!==a,l=r,h=P(s,l),g=t.value.substring(0,i),d=t.value.substring(i,a),f=t.value.substring(a),m,v,S;if(u)S=g+l+d+h+f,m=(g+l).length,v=(g+l+d).length;else{let L=(g+l).length;S=g+l+h+f,m=L,v=L}p(t,{isReversed:o,short:m,long:v,dir:c,value:S})}delete(e){let t=this.element,s=this.pairs,{long:r}=y(t),i=t.value.substring(0,r-1),a=t.value.substring(r+1),c=i+a,o=i.length,u=i.length;p(t,{isReversed:!1,short:o,long:u,dir:"forward",value:c})}};var M=function(n){let{key:e,altKey:t,ctrlKey:s,shiftKey:r}=x(n);return s&&!r&&e.toLowerCase()==="z"},V=function(n){let{key:e,altKey:t,ctrlKey:s,shiftKey:r}=x(n);return s&&r&&e.toLowerCase()==="z"},w=class{element;histories;index;maxCount;constructor(e){this.element=e,this.histories=[],this.index=1,this.maxCount=390}prune(){this.index>1&&(this.histories=this.histories.slice(0,this.histories.length-(this.index-1)),this.index=1)}add(e=!0){let t=this.element;if(e)this.prune();else if(this.index!==1)return;let s=y(t,!0);this.histories.push(s),this.histories.length>this.maxCount&&this.histories.shift()}prev(){this.index<this.histories.length&&(this.index+=1)}next(){this.index>1&&(this.index-=1)}curr(){return this.histories[this.histories.length-this.index]}undo(e){let t=this.element;this.prev();let s=this.curr();s&&p(t,s)}redo(e){let t=this.element;this.next();let s=this.curr();s&&p(t,s)}};var z=function(n){for(let e of n)if(e.value.startsWith("//"))return!0;return!1},T=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="/",this.removePattern=/^\/\/\s?/,this.newValue="// "}isValid(e){let{key:t,altKey:s,shiftKey:r}=e;return(e.ctrlKey||e.metaKey)&&!s&&!r&&t===this.key}exec(e){let t=this.element,{rows:s,selectedRows:r}=b(t),i=r.length>1,a=z(r),c=I(t,s,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(i){let l=!o.value.trim();return a?o.value.replace(this.removePattern,""):l?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});p(t,c)}};var E=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="Tab",this.removePattern=/^[^\S\n\r][^\S\n\r]?/,this.newValue="  "}isValid(e){let{key:t,altKey:s,shiftKey:r}=e;return!(e.ctrlKey||e.metaKey)&&!s&&t===this.key}exec(e){let t=this.element,{rows:s,selectedRows:r}=b(t),i=r.length>1,a=e.shiftKey,c=I(t,s,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(i){let l=!o.value.trim();return a?o.value.replace(this.removePattern,""):l?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});p(t,c)}};var W=function(n,e){let t=Object.keys(n).sort((s,r)=>r.length-s.length);for(let s of t){let{score:r}=A(s,e);if(r===s.length)return n[s]}},F=function(n,e){let t={};if(e>0)for(let s of n){let{key:r,value:i}=s,a=[],c=_(r.split(""));for(let u of c)u.length<=e&&a.push(u.join(""));let o=[...new Set(a)];for(let u of o)t[u]?t[u].push(s):t[u]=[s]}return t},R=class{element;tags;index;candidates;result;parser;filter;onLoad;_reqId;_state;_parts;constructor(e){this.element=e,this.tags=[],this.index={},this.candidates=[],this.result=[],this.parser=t=>{let s=t.value.split(/[,.\s․‧・｡。{}()<>[\]\\/|'"`!?]/),r=t.selectionStart,i=0,a=0;for(let l of s){if(a=i+l.length,r>=i&&r<=a)break;i=a+1}let c=t.value.substring(0,i),o=t.value.substring(i,a).trim().replace(/\s/g,"_"),u=t.value.substring(a);return{head:c,body:o,tail:u}},this.filter=()=>!0,this.onLoad=null,this._state=y(e,!0),this._parts={head:"",body:"",tail:""},this._reqId=0}createIndex(e=1){this.index=F(this.tags,e)}reset(){p(this.element,this._state)}set(e){let t=e.parts.head.length+e.tag.value.length,s=e.parts.head.length+e.tag.value.length,r=e.parts.head+e.tag.value+e.parts.tail,i={short:t,long:s,value:r};p(this.element,i)}exec(){let e=this._reqId+1,t=[],s=this._parts.body,r=this.candidates,i=this.parser(this.element),a=i.body,c=a?s&&a.indexOf(s)>-1?r:W(this.index,a)||this.tags:[];this.result=t,this.candidates=c,this._parts=i,this._state=y(this.element,!0),this._reqId=e;let o=!1,u=!1,l=0,h=d=>{o=!0,u=d||!1},g=()=>{if(this._reqId!==e||u)return;if(o){this.onLoad?.(t);return}let d=l+39;for(;;){if(l>=c.length){o=!0,setTimeout(g,0);return}if(l>=d){setTimeout(g,0);return}let f=c[l],m={...A(a,f.key),tag:f,parts:i,from:a,to:f.key};this.filter(m,l,c,h)&&t.push(m),l++}};g()}};var C=class{element;_keydownState;History;Commentify;Indentify;AutoPairing;AutoComplete;constructor(e){this.element=e,this._keydownState=null,this.History=new w(e),this.Commentify=new T(e),this.Indentify=new E(e),this.AutoPairing=new K(e,{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}),this.AutoComplete=new R(e),e.addEventListener("keydown",t=>{M(t)?(t.preventDefault(),this.History.undo(t),this._clearKeydownState()):V(t)?(t.preventDefault(),this.History.redo(t),this._clearKeydownState()):this.AutoPairing.isInsert(t)?(t.preventDefault(),this.AutoPairing.insert(t),this.History.add(),this._clearKeydownState()):this.AutoPairing.isDelete(t)?(t.preventDefault(),this.AutoPairing.delete(t),this.History.add(),this._clearKeydownState()):this.Commentify.isValid(t)?(t.preventDefault(),this.Commentify.exec(t),this.History.add(),this._clearKeydownState()):this.Indentify.isValid(t)?(t.preventDefault(),this.Indentify.exec(t),this.History.add(),this._clearKeydownState()):["Meta","Control","Alt","Shift"].includes(t.key)||this._setKeydownState(t)},!0),e.addEventListener("keyup",t=>{let s=this._keydownState;if(this._clearKeydownState(),!s)return;if(s.value!==e.value)this.History.add();else{let i=s.state,a=y(e);(i.short!==a.short||i.long!==a.long)&&this.History.add(!1)}},!0),e.addEventListener("keyup",t=>{(t.key.length===1||t.key==="Backspace")&&this.AutoComplete.exec()},!0),this.element.addEventListener("mouseup",t=>{this.History.add(!1)},!0)}getState(e){return y(this.element,e)}setState(e){p(this.element,e)}_clearKeydownState(){this._keydownState=null}_setKeydownState(e){this._keydownState={value:this.element.value,state:y(this.element),key:e.key}}};
