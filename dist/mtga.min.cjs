"use strict";var z=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var n in t)z(e,n,{get:t[n],enumerable:!0})},Y=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!J.call(e,o)&&o!==n&&z(e,o,{get:()=>t[o],enumerable:!(s=N(t,o))||s.enumerable});return e};var Z=e=>Y(z({},"__esModule",{value:!0}),e);var Ie={};X(Ie,{AutoCompleteModule:()=>V,AutoIndentModule:()=>P,AutoPairModule:()=>R,CommentModule:()=>k,HistoryModule:()=>G,IndentModule:()=>L,LineBreakModule:()=>_,LineCopyModule:()=>O,LineCutModule:()=>j,LineRemoveModule:()=>D,MTGA:()=>U});module.exports=Z(Ie);var x=function(e,t){let n=e.selectionStart>e.selectionEnd,s=Math.min(e.selectionStart,e.selectionEnd),o=Math.max(e.selectionStart,e.selectionEnd),c=e.selectionDirection;return t?{isReversed:n,short:s,long:o,dir:c,value:e.value}:{isReversed:n,short:s,long:o,dir:c}},B=function(e,t){typeof t.value=="string"&&(e.value=t.value),t.isReversed?e.setSelectionRange(t.long,t.short,t.dir||"none"):e.setSelectionRange(t.short,t.long,t.dir||"none"),e.focus()},S=function(e){let t=e.key,n=e.altKey,s=e.shiftKey,o=e.ctrlKey||e.metaKey;return{key:t,altKey:n,shiftKey:s,ctrlKey:o}};function Q(e,t){let n=Array.from({length:e.length+1},()=>Array(t.length+1).fill(0));for(let l=1;l<=e.length;l++)for(let u=1;u<=t.length;u++)e[l-1]===t[u-1]?n[l][u]=n[l-1][u-1]+1:n[l][u]=Math.max(n[l-1][u],n[l][u-1]);let s=[],o=0,c=e.length,r=t.length,i=null,d=[],a=function(){i!==null&&d.length>0&&s.push([i,d.reverse().join("")]),i=null,d=[]};for(;c>0||r>0;){let l=e[c-1],u=t[r-1];c>0&&r>0&&l===u?(i!==0&&a(),i=0,d.push(l),o++,c--,r--):r>0&&(c===0||n[c][r-1]>=n[c-1][r])?(i!==1&&a(),i=1,d.push(u),r--):c>0&&(i!==-1&&a(),i=-1,d.push(l),c--)}return a(),{accuracy:o*2/(e.length+t.length),score:o,match:s.reverse()}}var C=function(e){let{short:t,long:n}=x(e),s=e.value.split(/\n/),o=[],c=0;for(let r=0;r<s.length;r++){let i=s[r],d=r===s.length-1,a=d?i:i+`
`,l=c,u=l+a.length,h=-1,p=-1,v="";t>=l&&t<u&&(h=t-l),n>l&&(d?n<=u:n<u)&&(p=n-l),t<=l&&n>=u&&(h=0,p=a.length),h>-1&&p===-1&&(p=a.length),p>-1&&h===-1&&(h=0);let m={isSelected:h>-1&&p>-1,index:r,startIndex:l,endIndex:u,value:a,selectionStart:h,selectionEnd:p};o.push(m),c=u}return o};var I=class{parent;name;index;onKeydown;onKeyup;constructor(t,n,s=9999){this.parent=t,this.name=n,this.index=s}static defaults={}};var ee=function(e){if(e.defaultPrevented)return;let{key:t,altKey:n,ctrlKey:s,shiftKey:o}=S(e);if(!(s&&!n&&t.toLowerCase()==="z"))return;e.preventDefault();let r=this.getModule(G.name);if(!r){console.warn(`Module not found: ${G.name}`);return}let i;o?i=r.next():i=r.prev(),i&&this.setState(i)},te=function(e){let t=this._keydownState;if(this._clearKeydownState(),!t)return;let n=this.element,s=t.value,o=n.value;if(s!==o)this.addHistory();else{let c=t.state,r=x(n);(c.short!==r.short||c.long!==r.long)&&this.addHistory(!1)}},G=class e extends I{items;maxCount;_i;constructor(t){super(t,e.name,0),this.items=[],this.maxCount=e.defaults.maxCount,this._i=1}static name="History";static defaults={maxCount:390};onKeydown=ee;onKeyup=te;prune(){this._i>1&&(this.items=this.items.slice(0,this.items.length-(this._i-1)),this._i=1)}add(t=!0){let n=this.parent.element;if(t)this.prune();else if(this._i!==1)return;let s=this.items[this.items.length-1],o=x(n,!0);(!s||s.short!==o.short||s.long!==o.long||s.value!==o.value)&&(this.items.push(o),this.items.length>this.maxCount&&this.items.shift())}prev(){return this._i<this.items.length&&(this._i+=1),this.curr()}next(){return this._i>1&&(this._i-=1),this.curr()}curr(){return this.items[this.items.length-this._i]}};var ne=function(e){for(let t of e)if(!t.value.startsWith("//"))return!1;return!0},se=function(e){if(e.defaultPrevented)return;let t=this.getModule(k.name);if(!t){console.warn(`Module not found: ${k.name}`);return}let{key:n,altKey:s,ctrlKey:o,shiftKey:c}=S(e);if(!(o&&!s&&!c&&n==="/"))return;e.preventDefault();let i=this.element,{pattern:d,value:a}=t,l=C(i),{short:u,long:h,dir:p,isReversed:v}=x(i),g=l.filter(M=>M.isSelected),m=g.length>1,w=ne(g),f=u,K=h,T=[];for(let M=0;M<l.length;M++){let y=l[M],{startIndex:E,endIndex:H}=y,q=y.value;if(!y.isSelected){T.push(y.value);continue}let b;if(m){let $=!y.value.trim();w?b=y.value.replace(d,""):$?b=y.value:b=a+y.value}else w?b=y.value.replace(d,""):b=a+y.value;let A=b.length-q.length;u>=E&&u<H?A>=0?(f+=A,K+=A):(f+=Math.max(A,E-u),K+=Math.max(A,E-h)):h>=E&&u<H?A>=0?K+=A:K+=Math.max(A,E-h):(f+=A,K+=A),T.push(b)}this.setState({isReversed:v,short:f,long:K,dir:p,value:T.join("")}),this.addHistory()},oe=function(e){if(e.defaultPrevented)return;if(!this.getModule(k.name)){console.warn(`Module not found: ${k.name}`);return}let{key:n,altKey:s,ctrlKey:o,shiftKey:c}=S(e);if(!(!o&&!s&&c&&n==="*"))return;let i=this.element,{short:d,long:a,dir:l,isReversed:u}=x(i);if(d!==a||i.value.charAt(d-1)!=="/")return;e.preventDefault();let v=d+1,g=a+1,m=i.value.substring(0,d)+"**/"+i.value.substring(a);this.setState({isReversed:u,short:v,long:g,dir:l,value:m}),this.addHistory()},re=function(e){se.call(this,e),oe.call(this,e)},k=class e extends I{pattern;value;constructor(t){super(t,e.name),this.pattern=e.defaults.pattern,this.value=e.defaults.value}static name="Comment";static defaults={pattern:/^\/\/\s?/,value:"// "};onKeydown=re};var ie=function(e){if(e.defaultPrevented)return;let{key:t,altKey:n,ctrlKey:s,shiftKey:o}=S(e);if(!(!s&&!n&&t==="Tab"))return;e.preventDefault();let r=this.getModule(L.name);if(!r){console.warn(`Module not found: ${L.name}`);return}let i=this.element,{pattern:d,value:a}=r,l=C(i),{short:u,long:h,dir:p,isReversed:v}=x(i),m=l.filter(M=>M.isSelected).length>1,w=e.shiftKey,f=u,K=h,T=[];for(let M=0;M<l.length;M++){let y=l[M],{startIndex:E,endIndex:H}=y,q=y.value;if(!y.isSelected){T.push(y.value);continue}let b;if(m){let $=!y.value.trim();w?b=y.value.replace(d,""):$?b=y.value:b=a+y.value}else w?b=y.value.replace(d,""):b=a+y.value;let A=b.length-q.length;u>=E&&u<H?A>=0?(f+=A,K+=A):(f+=Math.max(A,E-u),K+=Math.max(A,E-h)):h>=E&&u<H?A>=0?K+=A:K+=Math.max(A,E-h):(f+=A,K+=A),T.push(b)}this.setState({isReversed:v,short:f,long:K,dir:p,value:T.join("")}),this.addHistory()},L=class e extends I{pattern;value;constructor(t){super(t,e.name),this.pattern=e.defaults.pattern,this.value=e.defaults.value}onKeydown=ie;static name="Indent";static defaults={pattern:/^[^\S\n\r][^\S\n\r]?/,value:"  "}};var le=function(e,t,n){return e[t]&&e[t]===n};var ae=function(e){let t=e.split(/\r\n|\r|\n/);return t[t.length-1].match(/^(\s*)/)?.[1]||""},ue=function(e){if(e.defaultPrevented)return;let t=this.getModule(P.name);if(!t){console.warn(`Module not found: ${P.name}`);return}let{key:n,altKey:s,ctrlKey:o,shiftKey:c}=S(e);if(!(!o&&!s&&!c&&n==="Enter"))return;e.preventDefault();let{pairs:i,indentUnit:d}=t,a=this.element,{short:l,long:u,dir:h,isReversed:p}=x(a),v=a.value.charAt(l-1),g=a.value.charAt(l),m=a.value.substring(0,l),w=`
`,f=a.value.substring(u),K=m.split(/\r\n|\r|\n/),T=K[K.length-1],M=ae(T),y=l+1;le(i,v,g)?(w+=M+d+`
`+M,y+=M.length+d.length):(w+=M,y+=M.length);let E=m+w+f,H=y;this.setState({isReversed:!1,short:y,long:H,dir:"none",value:E}),this.addHistory()},P=class e extends I{pairs;indentUnit;constructor(t){super(t,e.name),this.pairs=e.defaults.pairs,this.indentUnit=e.defaults.indentUnit}onKeydown=ue;static name="AutoIndent";static defaults={pairs:{"(":")","[":"]","{":"}"},indentUnit:"  "}};var ce=function(e,t){return Object.keys(e).includes(t)};var de=function(e,t,n){return e[t]&&e[t]===n};var he=function(e,t){return e[t]},fe=function(e){if(e.defaultPrevented)return;let t=this.getModule(R.name);if(!t){console.warn(`Module not found: ${R.name}`);return}let n=t.pairs,{key:s,altKey:o,ctrlKey:c,shiftKey:r}=S(e);if(!(!c&&!o&&ce(n,s)))return;e.preventDefault();let d=this.element,{short:a,long:l,dir:u,isReversed:h}=x(d),p=a!==l,v=s,g=he(n,v),m=d.value.substring(0,a),w=d.value.substring(a,l),f=d.value.substring(l),K,T,M;if(p)M=m+v+w+g+f,K=(m+v).length,T=(m+v+w).length;else{let y=(m+v).length;M=m+v+g+f,K=y,T=y}this.setState({isReversed:h,short:K,long:T,dir:u,value:M}),this.addHistory()},me=function(e){if(e.defaultPrevented)return;let t=this.getModule(R.name);if(!t){console.warn(`Module not found: ${R.name}`);return}let n=t.pairs,{key:s,altKey:o,ctrlKey:c,shiftKey:r}=S(e),i=this.element;if(!(!c&&!o&&!r&&s==="Backspace"))return;let{short:a,long:l}=x(i);if(a!==l)return;let h=i.value.charAt(a-1),p=i.value.charAt(a);if(!de(n,h,p))return;e.preventDefault();let v=i.value.substring(0,a-1),g=i.value.substring(a+1),m=v+g,w=v.length,f=v.length;this.setState({isReversed:!1,short:w,long:f,dir:"forward",value:m}),this.addHistory()},pe=function(e){fe.call(this,e),me.call(this,e)},R=class e extends I{pairs;constructor(t){super(t,e.name),this.pairs={...e.defaults.pairs}}onKeydown=pe;static name="AutoPair";static defaults={pairs:{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}}};var ge=function(e,t){for(let n of e)if(n.pattern.test(t))return n},ve=function(e){if(e.defaultPrevented)return;let{key:t,altKey:n,ctrlKey:s,shiftKey:o}=S(e);if(!(!s&&(t.length===1||t==="Backspace")))return;let r=this.getModule(V.name);if(!r){console.warn(`Module not found: ${V.name}`);return}r.stop(!0);let i=r._requestId+1,d=r._chunkSize,a=[],l=!1,u=!1,h=0,p=f=>{l=!0,u=f||!1};r._requestId=i,r._stop=p;let v=r.parser.call(this,this.element),g=v.body,m=[];if(g){let f=ge(r.indexes,g);f?m=f.tags:m=r.tags}let w=()=>{let f=[],K=h+d;for(;h<K&&h<m.length;){let M={tag:m[h],query:v};r.filter?.call(this,M,h,m,a)&&(f.push(M),a.push(M)),h++}if(!(u||r._requestId!==i)){if(l||h>=m.length){r.onData?.call(this,f,a),r.onEnd?.call(this,a);return}r.onData?.call(this,f,a),setTimeout(w,0)}};w()},V=class e extends I{tags;indexes;parser;filter;onData;onEnd;_requestId;_chunkSize;_stop;constructor(t){super(t,e.name,1),this.tags=[],this.indexes=[],this.parser=e.defaults.parser,this.filter=e.defaults.filter,this.onData=()=>{},this.onEnd=()=>{},this._requestId=0,this._chunkSize=e.defaults.chunkSize,this._stop=()=>{}}onKeyup=ve;static name="AutoComplete";static defaults={chunkSize:100,parser:t=>{let n=t.value.split(/[,.․‧・｡。{}()<>[\]\\/|'"`!?]|\r\n|\r|\n/),s=t.selectionStart,o=0,c=0;for(let l of n){if(c=o+l.length,s>=o&&s<=c)break;o=c+1}let r=t.value.substring(0,o),i=t.value.substring(o,c),d=t.value.substring(c),a=i.match(/^(\s*)(.*?)(\s*)$/);return a&&(r=r+(a[1]||""),i=a[2],d=(a[3]||"")+d),{head:r,body:i,tail:d}},filter:()=>!0};compare(t,n){return Q(t,n)}stop(t){let n=this._stop;n?.(t)}set(t){let n=t.query.head.length+t.tag.value.length,s=t.query.head.length+t.tag.value.length,o=t.query.head+t.tag.value+t.query.tail,c={short:n,long:s,value:o};this.parent.setState(c)}};var ye=function(e){if(e.defaultPrevented)return;let{key:t,altKey:n,ctrlKey:s,shiftKey:o}=S(e);if(!(s&&!n&&t==="Enter"))return;e.preventDefault();let r=this.element,{short:i,long:d,dir:a,isReversed:l}=x(r),u=C(r),h=u.filter(f=>f.isSelected),p=e.shiftKey?h[0]:h[h.length-1],v=u[u.length-1].index===h[h.length-1].index,g=[],m=i,w=d;for(let f of u){if(!(p.index===f.index)){g.push(f.value);continue}o?(g.push(`
`+f.value),m=f.startIndex,w=f.startIndex):(g.push(f.value+`
`),m=f.endIndex,w=f.endIndex)}!o&&v&&(m+=1,w+=1),this.setState({isReversed:!1,short:m,long:w,dir:"none",value:g.join("")}),this.addHistory()},_=class e extends I{constructor(t){super(t,e.name)}onKeydown=ye;static name="LineBreak";static defaults={}};var we=function(e){if(e.defaultPrevented)return;let{key:t,altKey:n,ctrlKey:s,shiftKey:o}=S(e);if(!(s&&!n&&o&&t.toLowerCase()==="k"))return;e.preventDefault();let r=this.element,i=C(r),d=i.filter(g=>g.isSelected),a=d[0],l=[],u=0,h=0;for(let g of i)g.isSelected||(g.index===a.index-1&&(u=g.startIndex,h=g.startIndex),l.push(g.value));let p=l.join("");d.length===1&&d[0].value===""&&i[i.length-1].index===d[0].index&&(p=p.substring(0,p.length-1)),this.setState({isReversed:!1,short:u,long:h,dir:"none",value:p}),this.addHistory()},D=class e extends I{constructor(t){super(t,e.name)}onKeydown=we;static name="LineRemove";static defaults={}};var Me=!!navigator.clipboard?.writeText,Ke=function(e){if(e.defaultPrevented)return;if(!Me){console.warn("navigator.clipboard.writeText not found");return}let t=this.element,{key:n,altKey:s,ctrlKey:o,shiftKey:c}=S(e),{short:r,long:i,dir:d,isReversed:a}=x(t);if(!(!(r!==i)&&o&&!s&&!c&&n.toLowerCase()==="x"))return;e.preventDefault();let h=C(t),p="",v=[],g=r,m=i;for(let w of h)w.isSelected?(g=w.startIndex,m=w.startIndex,p=w.value):v.push(w.value);if(!p){console.warn("No data selected");return}navigator.clipboard.writeText(p).then(()=>{this.setState({isReversed:!1,short:g,long:m,dir:"none",value:v.join("")}),this.addHistory()})},j=class e extends I{constructor(t){super(t,e.name)}onKeydown=Ke;static name="LineCut";static defaults={}};var xe=!!navigator.clipboard?.writeText,Se=function(e){if(e.defaultPrevented)return;if(!xe){console.warn("navigator.clipboard.writeText not found");return}let t=this.element,{key:n,altKey:s,ctrlKey:o,shiftKey:c}=S(e),{short:r,long:i,dir:d,isReversed:a}=x(t);if(!(!(r!==i)&&o&&!s&&!c&&n.toLowerCase()==="c"))return;e.preventDefault();let p=C(t).find(v=>v.isSelected)?.value;if(!p){console.warn("No data selected");return}navigator.clipboard.writeText(p)},O=class e extends I{constructor(t){super(t,e.name)}onKeydown=Se;static name="LineCopy";static defaults={}};var U=class{element;modules;moduleOrder;_keydownState;_keydownEvent;_keyupEvent;_focusEvent;_blurEvent;constructor(t){this.element=t,this.modules={},this.modules[G.name]=new G(this),this.modules[k.name]=new k(this),this.modules[L.name]=new L(this),this.modules[_.name]=new _(this),this.modules[D.name]=new D(this),this.modules[j.name]=new j(this),this.modules[O.name]=new O(this),this.modules[P.name]=new P(this),this.modules[R.name]=new R(this),this.modules[V.name]=new V(this),this.moduleOrder=[],this._keydownState=null,this._keydownEvent=s=>{for(let o of this.moduleOrder)o.onKeydown?.call(this,s);s.defaultPrevented?this._clearKeydownState():["Meta","Control","Alt","Shift"].includes(s.key)||this._setKeydownState(s)},this._keyupEvent=s=>{for(let o of this.moduleOrder)o.onKeyup?.call(this,s)};let n=s=>{this.addHistory(!1)};this._focusEvent=s=>{setTimeout(()=>{this.addHistory(!1),this.element.addEventListener("pointerup",n,!0)},0)},this._blurEvent=s=>{this.element.removeEventListener("pointerup",n,!0)},this.element.addEventListener("keydown",this._keydownEvent,!0),this.element.addEventListener("keyup",this._keyupEvent,!0),this.element.addEventListener("focus",this._focusEvent,!0),this.element.addEventListener("blur",this._blurEvent,!0),this.initOrder()}initOrder(){this.moduleOrder=Object.values(this.modules).sort((t,n)=>t.index-n.index)}getModule(t){return this.modules[t]}getState(t){return x(this.element,t)}setState(t){B(this.element,t)}addHistory(t=!0){this.getModule(G.name)?.add(t)}_clearKeydownState(){this._keydownState=null}_setKeydownState(t){this._keydownState={value:this.element.value,state:x(this.element),key:t.key}}};
