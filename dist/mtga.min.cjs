"use strict";var k=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var B=(s,e)=>{for(var t in e)k(s,t,{get:e[t],enumerable:!0})},U=(s,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of O(e))!z.call(s,i)&&i!==t&&k(s,i,{get:()=>e[i],enumerable:!(n=D(e,i))||n.enumerable});return s};var W=s=>U(k({},"__esModule",{value:!0}),s);var N={};B(N,{MTGA:()=>A});module.exports=W(N);var p=function(s,e){let t=s.selectionStart>s.selectionEnd,n=Math.min(s.selectionStart,s.selectionEnd),i=Math.max(s.selectionStart,s.selectionEnd),r=s.selectionDirection;return e?{isReversed:t,short:n,long:i,dir:r,value:s.value}:{isReversed:t,short:n,long:i,dir:r}},y=function(s,e){e.value&&(s.value=e.value),e.isReversed?s.setSelectionRange(e.long,e.short,e.dir||"none"):s.setSelectionRange(e.short,e.long,e.dir||"none"),s.focus()},H=function(s){let e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.left=s.offsetLeft+"px",e.style.top=s.offsetTop+"px";let t=getComputedStyle(s),n=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","whiteSpace","lineHeight","padding","border","boxSizing","width","height"];for(let u of n)e.style[u]=t[u];let i=s.value.substring(0,s.selectionStart);e.textContent=i;let r=document.createElement("span");r.textContent="\u200B",e.appendChild(r),document.body.appendChild(e);let a=r.getBoundingClientRect(),l=a.top,o=a.left;return document.body.removeChild(e),{top:l,left:o}},v=function(s){let e=s.key,t=s.altKey,n=s.shiftKey,i=s.ctrlKey||s.metaKey;return{key:e,altKey:t,shiftKey:n,ctrlKey:i}};function C(s,e){let t=Array.from({length:s.length+1},()=>Array(e.length+1).fill(0));for(let c=1;c<=s.length;c++)for(let h=1;h<=e.length;h++)s[c-1]===e[h-1]?t[c][h]=t[c-1][h-1]+1:t[c][h]=Math.max(t[c-1][h],t[c][h-1]);let n=[],i=0,r=s.length,a=e.length,l=null,o=[],u=function(){l!==null&&o.length>0&&n.push([l,o.reverse().join("")]),l=null,o=[]};for(;r>0||a>0;){let c=s[r-1],h=e[a-1];r>0&&a>0&&c===h?(l!==0&&u(),l=0,o.push(c),i++,r--,a--):a>0&&(r===0||t[r][a-1]>=t[r-1][a])?(l!==1&&u(),l=1,o.push(h),a--):r>0&&(l!==-1&&u(),l=-1,o.push(c),r--)}return u(),{accuracy:i*2/(s.length+e.length),score:i,match:n.reverse()}}function P(s){let e=[],t=s.length;for(let n=1;n<1<<t;n++){let i=[];for(let r=0;r<t;r++)n>>r&1&&i.push(s[r]);e.push(i)}return e}var b=function(s){let{short:e,long:t}=p(s),n=s.value.split(/\n/),i=[],r=[],a=0;for(let l=0;l<n.length;l++){let o=n[l],c=l===n.length-1?o:o+`
`,h=a,m=a+c.length,d=-1,f=-1,g="";e>=h&&e<m&&(d=e-h),t>h&&t<m&&(f=t-h),e<=h&&t>=m&&(d=0,f=c.length),d>-1&&f===-1&&(f=c.length),f>-1&&d===-1&&(d=0);let x=d>-1&&f>-1;x&&(g=c.substring(d,f));let S={rowIndex:l,startIndex:h,endIndex:m,value:c,selectionStart:d,selectionEnd:f,selectionValue:g};i.push(S),x&&r.push(S),a=m}return{rows:i,selectedRows:r}},w=function(s,e,t){let{short:n,long:i,dir:r,isReversed:a}=p(s),l=n,o=i,u=[];for(let c of e){let{startIndex:h,endIndex:m}=c,d=c.value,f=t(c),g=f.length-d.length;n>=h&&n<m?g>=0?(l+=g,o+=g):(l+=Math.max(g,h-n),o+=Math.max(g,h-i)):i>=h&&n<m?g>=0?o+=g:o+=Math.max(g,h-i):o+=g,u.push(f)}return{isReversed:a,short:l,long:o,dir:r,value:u.join("")}};var M=function(s,e){return Object.keys(s).includes(e)};var _=function(s,e){return s[e]},K=class{element;pairs;constructor(e,t){this.element=e,this.pairs=t}isInsert(e){let{key:t,altKey:n,ctrlKey:i,shiftKey:r}=v(e);return!n&&!i&&M(this.pairs,t)}isDelete(e){let t=this.element,n=this.pairs,{key:i,altKey:r,ctrlKey:a,shiftKey:l}=v(e);if(r||a||l||i!=="Backspace")return!1;let{short:o,long:u,dir:c,isReversed:h}=p(t);if(o!==u)return!1;let d=t.value.charAt(u-1),f=t.value.charAt(u);return M(n,d)&&_(n,d)===f}insert(e){let t=this.element,n=this.pairs,{key:i}=v(e),{short:r,long:a,dir:l,isReversed:o}=p(t),u=r!==a,c=i,h=_(n,c),m=t.value.substring(0,r),d=t.value.substring(r,a),f=t.value.substring(a),g,x,S;if(u)S=m+c+d+h+f,g=(m+c).length,x=(m+c+d).length;else{let L=(m+c).length;S=m+c+h+f,g=L,x=L}y(t,{isReversed:o,short:g,long:x,dir:l,value:S})}delete(e){let t=this.element,n=this.pairs,{long:i}=p(t),r=t.value.substring(0,i-1),a=t.value.substring(i+1),l=r+a,o=r.length,u=r.length;y(t,{isReversed:!1,short:o,long:u,dir:"forward",value:l})}};var V=function(s){let{key:e,altKey:t,ctrlKey:n,shiftKey:i}=v(s);return n&&!i&&e.toLowerCase()==="z"},j=function(s){let{key:e,altKey:t,ctrlKey:n,shiftKey:i}=v(s);return n&&i&&e.toLowerCase()==="z"},I=class{element;histories;index;maxCount;constructor(e){this.element=e,this.histories=[],this.index=1,this.maxCount=390}prune(){this.index>1&&(this.histories=this.histories.slice(0,this.histories.length-(this.index-1)),this.index=1)}add(e=!0){let t=this.element;if(e)this.prune();else if(this.index!==1)return;let n=p(t,!0);this.histories.push(n),this.histories.length>this.maxCount&&this.histories.shift()}prev(){this.index<this.histories.length&&(this.index+=1)}next(){this.index>1&&(this.index-=1)}curr(){return this.histories[this.histories.length-this.index]}undo(e){let t=this.element;this.prev();let n=this.curr();n&&y(t,n)}redo(e){let t=this.element;this.next();let n=this.curr();n&&y(t,n)}};var q=function(s){for(let e of s)if(e.value.startsWith("//"))return!0;return!1},E=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="/",this.removePattern=/^\/\/\s?/,this.newValue="// "}isValid(e){let{key:t,altKey:n,shiftKey:i}=e;return(e.ctrlKey||e.metaKey)&&!n&&!i&&t===this.key}exec(e){let t=this.element,{rows:n,selectedRows:i}=b(t),r=i.length>1,a=q(i),l=w(t,n,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(r){let c=!o.value.trim();return a?o.value.replace(this.removePattern,""):c?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});y(t,l)}};var T=class{element;key;removePattern;newValue;constructor(e){this.element=e,this.key="Tab",this.removePattern=/^[^\S\n\r][^\S\n\r]?/,this.newValue="  "}isValid(e){let{key:t,altKey:n,shiftKey:i}=e;return!(e.ctrlKey||e.metaKey)&&!n&&t===this.key}exec(e){let t=this.element,{rows:n,selectedRows:i}=b(t),r=i.length>1,a=e.shiftKey,l=w(t,n,o=>{if(!(o.selectionStart>-1||o.selectionEnd>-1))return o.value;if(r){let c=!o.value.trim();return a?o.value.replace(this.removePattern,""):c?o.value:this.newValue+o.value}else return a?o.value.replace(this.removePattern,""):this.newValue+o.value});y(t,l)}};var F=function(s,e){let t=Object.keys(s).sort((n,i)=>i.length-n.length);for(let n of t){let{score:i}=C(n,e);if(i===n.length)return s[n]}},J=function(s,e){let t={};if(e>0)for(let n of s){let{key:i,value:r}=n,a=[],l=P(i.split(""));for(let u of l)u.length<=e&&a.push(u.join(""));let o=[...new Set(a)];for(let u of o)t[u]?t[u].push(n):t[u]=[n]}return t},R=class{element;tags;index;result;parser;filter;onLoad;_stop;constructor(e){this.element=e,this.tags=[],this.index={},this.result=[],this.parser=t=>{let n=t.value.split(/[,.\s․‧・｡。{}()<>[\]\\/|'"`!?]/),i=t.selectionStart,r=0,a=0;for(let c of n){if(a=r+c.length,i>=r&&i<=a)break;r=a+1}let l=t.value.substring(0,r),o=t.value.substring(r,a).trim().replace(/\s/g,"_"),u=t.value.substring(a);return{head:l,body:o,tail:u}},this.filter=()=>!0,this._stop=null,this.onLoad=null}stop(e){this._stop?.(e),this._stop=null}createIndex(e=1){this.index=J(this.tags,e)}execSync(){this.stop(!0);let e=!1,t=!1;this._stop=l=>{e=!0,t=l||!1};let n=[],i=this.parser(this.element),r=i.body;this.result=n;let a=r?F(this.index,r)||this.tags:[];for(let l=0;l<a.length;l++){let o=a[l],u={...C(r,o.key),tag:o,parts:i};if((this.filter?this.filter(u,l,a):!0)&&n.push(u),e)break}return t||this.onLoad?.(n),n}async exec(){return this.execSync()}};var A=class{element;_keydownState;History;Commentify;Indentify;AutoPairing;AutoComplete;constructor(e){this.element=e,this._keydownState=null,this.History=new I(e),this.Commentify=new E(e),this.Indentify=new T(e),this.AutoPairing=new K(e,{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}),this.AutoComplete=new R(e),e.addEventListener("keydown",t=>{V(t)?(t.preventDefault(),this.History.undo(t),this._clearKeydownState()):j(t)?(t.preventDefault(),this.History.redo(t),this._clearKeydownState()):this.AutoPairing.isInsert(t)?(t.preventDefault(),this.AutoPairing.insert(t),this.History.add(),this._clearKeydownState()):this.AutoPairing.isDelete(t)?(t.preventDefault(),this.AutoPairing.delete(t),this.History.add(),this._clearKeydownState()):this.Commentify.isValid(t)?(t.preventDefault(),this.Commentify.exec(t),this.History.add(),this._clearKeydownState()):this.Indentify.isValid(t)?(t.preventDefault(),this.Indentify.exec(t),this.History.add(),this._clearKeydownState()):["Meta","Control","Alt","Shift"].includes(t.key)||this._setKeydownState(t)}),e.addEventListener("keyup",t=>{let n=this._keydownState;if(this._clearKeydownState(),!n)return;if(n.value!==e.value)this.History.add(),this.AutoComplete.exec();else{let r=n.state,a=p(e);(r.short!==a.short||r.long!==a.long)&&this.History.add(!1)}}),this.element.addEventListener("mouseup",t=>{this.History.add(!1)})}getState(e){return p(this.element,e)}setState(e){y(this.element,e)}getCaretPosition(){return H(this.element)}_clearKeydownState(){this._keydownState=null}_setKeydownState(e){this._keydownState={value:this.element.value,state:p(this.element),key:e.key}}};
