"use strict";var MtgaJs=(()=>{var z=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var J=(t,e)=>{for(var n in e)z(t,n,{get:e[n],enumerable:!0})},X=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of U(e))!W.call(t,r)&&r!==n&&z(t,r,{get:()=>e[r],enumerable:!(s=N(e,r))||s.enumerable});return t};var Y=t=>X(z({},"__esModule",{value:!0}),t);var Ke={};J(Ke,{AutoCompleteModule:()=>V,AutoPairModule:()=>R,CommentModule:()=>k,HistoryModule:()=>G,IndentModule:()=>L,LineBreakModule:()=>P,LineCopyModule:()=>D,LineCutModule:()=>H,LineRemoveModule:()=>_,MTGA:()=>$});var M=function(t,e){let n=t.selectionStart>t.selectionEnd,s=Math.min(t.selectionStart,t.selectionEnd),r=Math.max(t.selectionStart,t.selectionEnd),c=t.selectionDirection;return e?{isReversed:n,short:s,long:r,dir:c,value:t.value}:{isReversed:n,short:s,long:r,dir:c}},B=function(t,e){typeof e.value=="string"&&(t.value=e.value),e.isReversed?t.setSelectionRange(e.long,e.short,e.dir||"none"):t.setSelectionRange(e.short,e.long,e.dir||"none"),t.focus()},x=function(t){let e=t.key,n=t.altKey,s=t.shiftKey,r=t.ctrlKey||t.metaKey;return{key:e,altKey:n,shiftKey:s,ctrlKey:r}};function Q(t,e){let n=Array.from({length:t.length+1},()=>Array(e.length+1).fill(0));for(let l=1;l<=t.length;l++)for(let a=1;a<=e.length;a++)t[l-1]===e[a-1]?n[l][a]=n[l-1][a-1]+1:n[l][a]=Math.max(n[l-1][a],n[l][a-1]);let s=[],r=0,c=t.length,o=e.length,i=null,d=[],u=function(){i!==null&&d.length>0&&s.push([i,d.reverse().join("")]),i=null,d=[]};for(;c>0||o>0;){let l=t[c-1],a=e[o-1];c>0&&o>0&&l===a?(i!==0&&u(),i=0,d.push(l),r++,c--,o--):o>0&&(c===0||n[c][o-1]>=n[c-1][o])?(i!==1&&u(),i=1,d.push(a),o--):c>0&&(i!==-1&&u(),i=-1,d.push(l),c--)}return u(),{accuracy:r*2/(t.length+e.length),score:r,match:s.reverse()}}var E=function(t){let{short:e,long:n}=M(t),s=t.value.split(/\n/),r=[],c=0;for(let o=0;o<s.length;o++){let i=s[o],d=o===s.length-1,u=d?i:i+`
`,l=c,a=l+u.length,h=-1,f=-1,m="";e>=l&&e<a&&(h=e-l),n>l&&(d?n<=a:n<a)&&(f=n-l),e<=l&&n>=a&&(h=0,f=u.length),h>-1&&f===-1&&(f=u.length),f>-1&&h===-1&&(h=0);let p={isSelected:h>-1&&f>-1,index:o,startIndex:l,endIndex:a,value:u,selectionStart:h,selectionEnd:f};r.push(p),c=a}return r};var S=class{parent;name;index;onKeydown;onKeyup;constructor(e,n,s=9999){this.parent=e,this.name=n,this.index=s}static defaults={}};var Z=function(t){if(t.defaultPrevented)return;let{key:e,altKey:n,ctrlKey:s,shiftKey:r}=x(t);if(!(s&&!n&&e.toLowerCase()==="z"))return;t.preventDefault();let o=this.getModule(G.name);if(!o){console.warn(`Module not found: ${G.name}`);return}let i;r?i=o.next():i=o.prev(),i&&this.setState(i)},ee=function(t){let e=this._keydownState;if(this._clearKeydownState(),!e)return;let n=this.element,s=e.value,r=n.value;if(s!==r)this.addHistory();else{let c=e.state,o=M(n);(c.short!==o.short||c.long!==o.long)&&this.addHistory(!1)}},G=class t extends S{items;maxCount;_i;constructor(e){super(e,t.name,0),this.items=[],this.maxCount=t.defaults.maxCount,this._i=1}static name="History";static defaults={maxCount:390};onKeydown=Z;onKeyup=ee;prune(){this._i>1&&(this.items=this.items.slice(0,this.items.length-(this._i-1)),this._i=1)}add(e=!0){let n=this.parent.element;if(e)this.prune();else if(this._i!==1)return;let s=this.items[this.items.length-1],r=M(n,!0);(!s||s.short!==r.short||s.long!==r.long||s.value!==r.value)&&(this.items.push(r),this.items.length>this.maxCount&&this.items.shift())}prev(){return this._i<this.items.length&&(this._i+=1),this.curr()}next(){return this._i>1&&(this._i-=1),this.curr()}curr(){return this.items[this.items.length-this._i]}};var te=function(t){for(let e of t)if(!e.value.startsWith("//"))return!1;return!0},ne=function(t){if(t.defaultPrevented)return;let e=this.getModule(k.name);if(!e){console.warn(`Module not found: ${k.name}`);return}let{key:n,altKey:s,ctrlKey:r,shiftKey:c}=x(t);if(!(r&&!s&&!c&&n==="/"))return;t.preventDefault();let i=this.element,{pattern:d,value:u}=e,l=E(i),{short:a,long:h,dir:f,isReversed:m}=M(i),v=l.filter(b=>b.isSelected),p=v.length>1,g=te(v),y=a,A=h,I=[];for(let b=0;b<l.length;b++){let w=l[b],{startIndex:C,endIndex:O}=w,j=w.value;if(!w.isSelected){I.push(w.value);continue}let T;if(p){let q=!w.value.trim();g?T=w.value.replace(d,""):q?T=w.value:T=u+w.value}else g?T=w.value.replace(d,""):T=u+w.value;let K=T.length-j.length;a>=C&&a<O?K>=0?(y+=K,A+=K):(y+=Math.max(K,C-a),A+=Math.max(K,C-h)):h>=C&&a<O?K>=0?A+=K:A+=Math.max(K,C-h):(y+=K,A+=K),I.push(T)}this.setState({isReversed:m,short:y,long:A,dir:f,value:I.join("")}),this.addHistory()},se=function(t){if(t.defaultPrevented)return;if(!this.getModule(k.name)){console.warn(`Module not found: ${k.name}`);return}let{key:n,altKey:s,ctrlKey:r,shiftKey:c}=x(t);if(!(!r&&!s&&c&&n==="*"))return;let i=this.element,{short:d,long:u,dir:l,isReversed:a}=M(i);if(d!==u||i.value.charAt(d-1)!=="/")return;t.preventDefault();let m=d+2,v=u+2,p=i.value.substring(0,d)+"*  */"+i.value.substring(u);this.setState({isReversed:a,short:m,long:v,dir:l,value:p}),this.addHistory()},oe=function(t){ne.call(this,t),se.call(this,t)},k=class t extends S{pattern;value;constructor(e){super(e,t.name),this.pattern=t.defaults.pattern,this.value=t.defaults.value}static name="Comment";static defaults={pattern:/^\/\/\s?/,value:"// "};onKeydown=oe};var re=function(t){if(t.defaultPrevented)return;let{key:e,altKey:n,ctrlKey:s,shiftKey:r}=x(t);if(!(!s&&!n&&e==="Tab"))return;t.preventDefault();let o=this.getModule(L.name);if(!o){console.warn(`Module not found: ${L.name}`);return}let i=this.element,{pattern:d,value:u}=o,l=E(i),{short:a,long:h,dir:f,isReversed:m}=M(i),p=l.filter(b=>b.isSelected).length>1,g=t.shiftKey,y=a,A=h,I=[];for(let b=0;b<l.length;b++){let w=l[b],{startIndex:C,endIndex:O}=w,j=w.value;if(!w.isSelected){I.push(w.value);continue}let T;if(p){let q=!w.value.trim();g?T=w.value.replace(d,""):q?T=w.value:T=u+w.value}else g?T=w.value.replace(d,""):T=u+w.value;let K=T.length-j.length;a>=C&&a<O?K>=0?(y+=K,A+=K):(y+=Math.max(K,C-a),A+=Math.max(K,C-h)):h>=C&&a<O?K>=0?A+=K:A+=Math.max(K,C-h):(y+=K,A+=K),I.push(T)}this.setState({isReversed:m,short:y,long:A,dir:f,value:I.join("")}),this.addHistory()},L=class t extends S{pattern;value;constructor(e){super(e,t.name),this.pattern=t.defaults.pattern,this.value=t.defaults.value}onKeydown=re;static name="Indent";static defaults={pattern:/^[^\S\n\r][^\S\n\r]?/,value:"  "}};var ie=function(t,e){for(let n of t)if(n.pattern.test(e))return n},le=function(t){if(t.defaultPrevented)return;let{key:e,altKey:n,ctrlKey:s,shiftKey:r}=x(t);if(!(!s&&(e.length===1||e==="Backspace")))return;let o=this.getModule(V.name);if(!o){console.warn(`Module not found: ${V.name}`);return}o.stop(!0);let i=o._requestId+1,d=o._chunkSize,u=[],l=!1,a=!1,h=0,f=y=>{l=!0,a=y||!1};o._requestId=i,o._stop=f;let m=o.parser.call(this,this.element),v=m.body,p=[];if(v){let y=ie(o.indexes,v);y?p=y.tags:p=o.tags}let g=()=>{let y=[],A=h+d;for(;h<A&&h<p.length;){let b={tag:p[h],query:m};o.filter?.call(this,b,h,p,u)&&(y.push(b),u.push(b)),h++}if(!(a||o._requestId!==i)){if(l||h>=p.length){o.onData?.call(this,y,u),o.onEnd?.call(this,u);return}o.onData?.call(this,y,u),setTimeout(g,0)}};g()},V=class t extends S{tags;indexes;parser;filter;onData;onEnd;_requestId;_chunkSize;_stop;constructor(e){super(e,t.name,1),this.tags=[],this.indexes=[],this.parser=t.defaults.parser,this.filter=t.defaults.filter,this.onData=()=>{},this.onEnd=()=>{},this._requestId=0,this._chunkSize=t.defaults.chunkSize,this._stop=()=>{}}onKeyup=le;static name="AutoComplete";static defaults={chunkSize:100,parser:e=>{let n=e.value.split(/[,.․‧・｡。{}()<>[\]\\/|'"`!?]|\r\n|\r|\n/),s=e.selectionStart,r=0,c=0;for(let l of n){if(c=r+l.length,s>=r&&s<=c)break;r=c+1}let o=e.value.substring(0,r),i=e.value.substring(r,c),d=e.value.substring(c),u=i.match(/^(\s*)(.*?)(\s*)$/);return u&&(o=o+(u[1]||""),i=u[2],d=(u[3]||"")+d),{head:o,body:i,tail:d}},filter:()=>!0};compare(e,n){return Q(e,n)}stop(e){let n=this._stop;n?.(e)}set(e){let n=e.query.head.length+e.tag.value.length,s=e.query.head.length+e.tag.value.length,r=e.query.head+e.tag.value+e.query.tail,c={short:n,long:s,value:r};this.parent.setState(c)}};var ae=function(t,e){return Object.keys(t).includes(e)};var ue=function(t,e,n){return t[e]&&t[e]===n};var ce=function(t,e){return t[e]},de=function(t){if(t.defaultPrevented)return;let e=this.getModule(R.name);if(!e){console.warn(`Module not found: ${R.name}`);return}let n=e.pairs,{key:s,altKey:r,ctrlKey:c,shiftKey:o}=x(t);if(!(!c&&!r&&ae(n,s)))return;t.preventDefault();let d=this.element,{short:u,long:l,dir:a,isReversed:h}=M(d),f=u!==l,m=s,v=ce(n,m),p=d.value.substring(0,u),g=d.value.substring(u,l),y=d.value.substring(l),A,I,b;if(f)b=p+m+g+v+y,A=(p+m).length,I=(p+m+g).length;else{let w=(p+m).length;b=p+m+v+y,A=w,I=w}this.setState({isReversed:h,short:A,long:I,dir:a,value:b}),this.addHistory()},he=function(t){if(t.defaultPrevented)return;let e=this.getModule(R.name);if(!e){console.warn(`Module not found: ${R.name}`);return}let n=e.pairs,{key:s,altKey:r,ctrlKey:c,shiftKey:o}=x(t),i=this.element;if(!(!c&&!r&&!o&&s==="Backspace"))return;let{short:u,long:l}=M(i);if(u!==l)return;let h=i.value.charAt(u-1),f=i.value.charAt(u);if(!ue(n,h,f))return;t.preventDefault();let m=i.value.substring(0,u-1),v=i.value.substring(u+1),p=m+v,g=m.length,y=m.length;this.setState({isReversed:!1,short:g,long:y,dir:"forward",value:p}),this.addHistory()},fe=function(t){de.call(this,t),he.call(this,t)},R=class t extends S{pairs;constructor(e){super(e,t.name),this.pairs={...t.defaults.pairs}}onKeydown=fe;static name="AutoPair";static defaults={pairs:{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}}};var me=function(t){if(t.defaultPrevented)return;let{key:e,altKey:n,ctrlKey:s,shiftKey:r}=x(t);if(!(s&&!n&&e==="Enter"))return;t.preventDefault();let o=this.element,{short:i,long:d,dir:u,isReversed:l}=M(o),a=E(o),h=a.filter(g=>g.isSelected),f=t.shiftKey?h[0]:h[h.length-1],m=[],v=i,p=d;for(let g of a){if(!(f.index===g.index)){m.push(g.value);continue}t.shiftKey?(m.push(`
`+g.value),v=g.startIndex,p=g.startIndex):(m.push(g.value+`
`),v=g.endIndex,p=g.endIndex)}this.setState({isReversed:!1,short:v,long:p,dir:"none",value:m.join("")}),this.addHistory()},P=class t extends S{constructor(e){super(e,t.name)}onKeydown=me;static name="LineBreak";static defaults={}};var pe=function(t){if(t.defaultPrevented)return;let{key:e,altKey:n,ctrlKey:s,shiftKey:r}=x(t);if(!(s&&!n&&r&&e.toLowerCase()==="k"))return;t.preventDefault();let o=this.element,i=E(o),d=i.filter(v=>v.isSelected),u=d[0],l=[],a=0,h=0;for(let v of i)v.isSelected||(v.index===u.index-1&&(a=v.startIndex,h=v.startIndex),l.push(v.value));let f=l.join("");d.length===1&&d[0].value===""&&i[i.length-1].index===d[0].index&&(f=f.substring(0,f.length-1)),this.setState({isReversed:!1,short:a,long:h,dir:"none",value:f}),this.addHistory()},_=class t extends S{constructor(e){super(e,t.name)}onKeydown=pe;static name="LineRemove";static defaults={}};var ge=!!navigator.clipboard?.writeText,ve=function(t){if(t.defaultPrevented)return;if(!ge){console.warn("navigator.clipboard.writeText not found");return}let e=this.element,{key:n,altKey:s,ctrlKey:r,shiftKey:c}=x(t),{short:o,long:i,dir:d,isReversed:u}=M(e);if(!(!(o!==i)&&r&&!s&&!c&&n.toLowerCase()==="x"))return;t.preventDefault();let h=E(e),f="",m=[],v=o,p=i;for(let g of h)g.isSelected?(v=g.startIndex,p=g.startIndex,f=g.value):m.push(g.value);if(!f){console.warn("No data selected");return}navigator.clipboard.writeText(f).then(()=>{this.setState({isReversed:!1,short:v,long:p,dir:"none",value:m.join("")}),this.addHistory()})},H=class t extends S{constructor(e){super(e,t.name)}onKeydown=ve;static name="LineCut";static defaults={}};var ye=!!navigator.clipboard?.writeText,we=function(t){if(t.defaultPrevented)return;if(!ye){console.warn("navigator.clipboard.writeText not found");return}let e=this.element,{key:n,altKey:s,ctrlKey:r,shiftKey:c}=x(t),{short:o,long:i,dir:d,isReversed:u}=M(e);if(!(!(o!==i)&&r&&!s&&!c&&n.toLowerCase()==="c"))return;t.preventDefault();let f=E(e).find(m=>m.isSelected)?.value;if(!f){console.warn("No data selected");return}navigator.clipboard.writeText(f)},D=class t extends S{constructor(e){super(e,t.name)}onKeydown=we;static name="LineCopy";static defaults={}};var $=class{element;modules;moduleOrder;_keydownState;_keydownEvent;_keyupEvent;_focusEvent;_blurEvent;constructor(e){this.element=e,this.modules={},this.modules[G.name]=new G(this),this.modules[k.name]=new k(this),this.modules[L.name]=new L(this),this.modules[P.name]=new P(this),this.modules[_.name]=new _(this),this.modules[H.name]=new H(this),this.modules[D.name]=new D(this),this.modules[R.name]=new R(this),this.modules[V.name]=new V(this),this.moduleOrder=[],this._keydownState=null,this._keydownEvent=s=>{for(let r of this.moduleOrder)r.onKeydown?.call(this,s);s.defaultPrevented?this._clearKeydownState():["Meta","Control","Alt","Shift"].includes(s.key)||this._setKeydownState(s)},this._keyupEvent=s=>{for(let r of this.moduleOrder)r.onKeyup?.call(this,s)};let n=s=>{this.addHistory(!1)};this._focusEvent=s=>{setTimeout(()=>{this.addHistory(!1),this.element.addEventListener("pointerup",n,!0)},0)},this._blurEvent=s=>{this.element.removeEventListener("pointerup",n,!0)},this.element.addEventListener("keydown",this._keydownEvent,!0),this.element.addEventListener("keyup",this._keyupEvent,!0),this.element.addEventListener("focus",this._focusEvent,!0),this.element.addEventListener("blur",this._blurEvent,!0),this.initOrder()}initOrder(){this.moduleOrder=Object.values(this.modules).sort((e,n)=>e.index-n.index)}getModule(e){return this.modules[e]}getState(e){return M(this.element,e)}setState(e){B(this.element,e)}addHistory(e=!0){this.getModule(G.name)?.add(e)}_clearKeydownState(){this._keydownState=null}_setKeydownState(e){this._keydownState={value:this.element.value,state:M(this.element),key:e.key}}};return Y(Ke);})();
