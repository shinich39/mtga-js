"use strict";var MtgaJs=(()=>{var k=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var z=(s,t)=>{for(var e in t)k(s,e,{get:t[e],enumerable:!0})},B=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of O(t))!W.call(s,i)&&i!==e&&k(s,i,{get:()=>t[i],enumerable:!(n=D(t,i))||n.enumerable});return s};var U=s=>B(k({},"__esModule",{value:!0}),s);var Y={};z(Y,{MTGA:()=>C});var m=function(s,t){let e=s.selectionStart>s.selectionEnd,n=Math.min(s.selectionStart,s.selectionEnd),i=Math.max(s.selectionStart,s.selectionEnd),o=s.selectionDirection;return t?{isReversed:e,short:n,long:i,dir:o,value:s.value}:{isReversed:e,short:n,long:i,dir:o}},y=function(s,t){t.value&&(s.value=t.value),t.isReversed?s.setSelectionRange(t.long,t.short,t.dir||"none"):s.setSelectionRange(t.short,t.long,t.dir||"none"),s.focus()},H=function(s){let t=document.createElement("div");t.style.position="absolute",t.style.whiteSpace="pre-wrap",t.style.visibility="hidden",t.style.left="0",t.style.top="0";let e=getComputedStyle(s),n=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize"];for(let l of n)t.style[l]=e[l];let i=s.value.substring(0,s.selectionStart);t.textContent=i;let o=document.createElement("span");o.textContent="\u200B",t.appendChild(o),document.body.appendChild(t);let a=o.getBoundingClientRect();return document.body.removeChild(t),{top:a.top,left:a.left}},v=function(s){let t=s.key,e=s.altKey,n=s.shiftKey,i=s.ctrlKey||s.metaKey;return{key:t,altKey:e,shiftKey:n,ctrlKey:i}};function A(s,t){let e=Array.from({length:s.length+1},()=>Array(t.length+1).fill(0));for(let c=1;c<=s.length;c++)for(let u=1;u<=t.length;u++)s[c-1]===t[u-1]?e[c][u]=e[c-1][u-1]+1:e[c][u]=Math.max(e[c-1][u],e[c][u-1]);let n=[],i=0,o=s.length,a=t.length,l=null,r=[],h=function(){l!==null&&r.length>0&&n.push([l,r.reverse().join("")]),l=null,r=[]};for(;o>0||a>0;){let c=s[o-1],u=t[a-1];o>0&&a>0&&c===u?(l!==0&&h(),l=0,r.push(c),i++,o--,a--):a>0&&(o===0||e[o][a-1]>=e[o-1][a])?(l!==1&&h(),l=1,r.push(u),a--):o>0&&(l!==-1&&h(),l=-1,r.push(c),o--)}return h(),{accuracy:i*2/(s.length+t.length),score:i,match:n.reverse()}}function _(s){let t=[],e=s.length;for(let n=1;n<1<<e;n++){let i=[];for(let o=0;o<e;o++)n>>o&1&&i.push(s[o]);t.push(i)}return t}var b=function(s){let{short:t,long:e}=m(s),n=s.value.split(/\n/),i=[],o=[],a=0;for(let l=0;l<n.length;l++){let r=n[l],c=l===n.length-1?r:r+`
`,u=a,p=a+r.length+1,d=-1,f=-1,g="";t>=u&&t<p&&(d=t-u),e>u&&e<p&&(f=e-u),t<=u&&e>=p&&(d=0,f=c.length),d>-1&&f===-1&&(f=c.length),f>-1&&d===-1&&(d=0);let x=d>-1&&f>-1;x&&(g=c.substring(d,f));let S={rowIndex:l,startIndex:u,endIndex:p,value:c,selectionStart:d,selectionEnd:f,selectionValue:g};i.push(S),x&&o.push(S),a=p}return{rows:i,selectedRows:o}},w=function(s,t,e){let{short:n,long:i,dir:o,isReversed:a}=m(s),l=n,r=i,h=[];for(let c of t){let{startIndex:u,endIndex:p}=c,d=c.value,f=e(c),g=f.length-d.length;n>=u&&n<p?g>=0?(l+=g,r+=g):(l+=Math.max(g,u-n),r+=Math.max(g,u-i)):i>=u&&n<p?g>=0?r+=g:r+=Math.max(g,u-i):r+=g,h.push(f)}return{isReversed:a,short:l,long:r,dir:o,value:h.join("")}};var P=function(s,t){return Object.keys(s).includes(t)};var M=function(s,t){return s[t]},K=class{element;pairs;constructor(t,e){this.element=t,this.pairs=e}isInsert(t){let{key:e,altKey:n,ctrlKey:i,shiftKey:o}=v(t);return!n&&!i&&P(this.pairs,e)}isDelete(t){let e=this.element,n=this.pairs,{key:i,altKey:o,ctrlKey:a,shiftKey:l}=v(t);if(o||a||l||i!=="Backspace")return!1;let{short:r,long:h,dir:c,isReversed:u}=m(e);if(r!==h)return!1;let d=e.value.charAt(h-1),f=e.value.charAt(h);return P(n,d)&&M(n,d)===f}insert(t){let e=this.element,n=this.pairs,{key:i}=v(t),{short:o,long:a,dir:l,isReversed:r}=m(e),h=o!==a,c=i,u=M(n,c),p=e.value.substring(0,o),d=e.value.substring(o,a),f=e.value.substring(a),g,x,S;if(h)S=p+c+d+u+f,g=(p+c).length,x=(p+c+d).length;else{let L=(p+c).length;S=p+c+u+f,g=L,x=L}y(e,{isReversed:r,short:g,long:x,dir:l,value:S})}delete(t){let e=this.element,n=this.pairs,{long:i}=m(e),o=e.value.substring(0,i-1),a=e.value.substring(i+1),l=o+a,r=o.length,h=o.length;y(e,{isReversed:!1,short:r,long:h,dir:"forward",value:l})}};var V=function(s){let{key:t,altKey:e,ctrlKey:n,shiftKey:i}=v(s);return n&&!i&&t.toLowerCase()==="z"},j=function(s){let{key:t,altKey:e,ctrlKey:n,shiftKey:i}=v(s);return n&&i&&t.toLowerCase()==="z"},I=class{element;histories;index;maxCount;constructor(t){this.element=t,this.histories=[],this.index=1,this.maxCount=390}prune(){this.index>1&&(this.histories=this.histories.slice(0,this.histories.length-(this.index-1)),this.index=1)}add(t=!0){let e=this.element;if(t)this.prune();else if(this.index!==1)return;let n=m(e,!0);this.histories.push(n),this.histories.length>this.maxCount&&this.histories.shift()}prev(){this.index<this.histories.length&&(this.index+=1)}next(){this.index>1&&(this.index-=1)}curr(){return this.histories[this.histories.length-this.index]}undo(t){let e=this.element;this.prev();let n=this.curr();n&&y(e,n)}redo(t){let e=this.element;this.next();let n=this.curr();n&&y(e,n)}};var q=function(s){for(let t of s)if(t.value.startsWith("//"))return!0;return!1},E=class{element;key;removePattern;newValue;constructor(t){this.element=t,this.key="/",this.removePattern=/^\/\/\s?/,this.newValue="// "}isValid(t){let{key:e,altKey:n,shiftKey:i}=t;return(t.ctrlKey||t.metaKey)&&!n&&!i&&e===this.key}exec(t){let e=this.element,{rows:n,selectedRows:i}=b(e),o=i.length>1,a=q(i),l=w(e,n,r=>{if(!(r.selectionStart>-1||r.selectionEnd>-1))return r.value;if(o){let c=!r.value.trim();return a?r.value.replace(this.removePattern,""):c?r.value:this.newValue+r.value}else return a?r.value.replace(this.removePattern,""):this.newValue+r.value});y(e,l)}};var T=class{element;key;removePattern;newValue;constructor(t){this.element=t,this.key="Tab",this.removePattern=/^[^\S\n\r][^\S\n\r]?/,this.newValue="  "}isValid(t){let{key:e,altKey:n,shiftKey:i}=t;return!(t.ctrlKey||t.metaKey)&&!n&&e===this.key}exec(t){let e=this.element,{rows:n,selectedRows:i}=b(e),o=i.length>1,a=t.shiftKey,l=w(e,n,r=>{if(!(r.selectionStart>-1||r.selectionEnd>-1))return r.value;if(o){let c=!r.value.trim();return a?r.value.replace(this.removePattern,""):c?r.value:this.newValue+r.value}else return a?r.value.replace(this.removePattern,""):this.newValue+r.value});y(e,l)}};var F=function(s,t){let e=Object.keys(s).sort((n,i)=>i.length-n.length);for(let n of e){let{score:i}=A(n,t);if(i===n.length)return s[n]}},X=function(s,t){let e={};if(t>0)for(let n of s){let{key:i,value:o}=n,a=[],l=_(i.split(""));for(let h of l)h.length<=t&&a.push(h.join(""));let r=[...new Set(a)];for(let h of r)e[h]?e[h].push(n):e[h]=[n]}return e},R=class{element;tags;index;result;parser;filter;onLoad;_state;_stop;constructor(t){this.element=t,this.tags=[],this.index={},this._state=m(t,!0),this.result=[],this.parser=e=>{let n=e.value.split(/[,.\s․‧・｡。{}()<>[\]\\/|'"`!?]/),i=e.selectionStart,o=0,a=0;for(let c of n){if(a=o+c.length,i>=o&&i<=a)break;o=a+1}let l=e.value.substring(0,o),r=e.value.substring(o,a).trim().replace(/\s/g,"_"),h=e.value.substring(a);return{head:l,body:r,tail:h}},this.filter=()=>!0,this._stop=null,this.onLoad=null}stop(t){this._stop&&this._stop(t)}clear(){this._stop&&this._stop(!0),this.result=[]}createIndex(t=1){this.index=X(this.tags,t)}reset(){y(this.element,this._state)}set(t){let e=t.parts.head.length+t.tag.value.length,n=t.parts.head.length+t.tag.value.length,i=t.parts.head+t.tag.value+t.parts.tail,o={short:e,long:n,value:i};y(this.element,o)}exec(){this.clear(),this._state=m(this.element,!0);let t=!1,e=!1;this._stop=r=>{t=!0,e=r||!1,this._stop=null};let n=this._stop,i=this.result,o=this.parser(this.element),a=o.body,l=a?F(this.index,a)||this.tags:[];for(let r=0;r<l.length;r++){let h=l[r],c={...A(a,h.key),tag:h,parts:o};if(this.filter(c,r,l,n)&&i.push(c),t)break}return e||this.onLoad?.(i),i}};var C=class{element;_keydownState;History;Commentify;Indentify;AutoPairing;AutoComplete;constructor(t){this.element=t,this._keydownState=null,this.History=new I(t),this.Commentify=new E(t),this.Indentify=new T(t),this.AutoPairing=new K(t,{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"}),this.AutoComplete=new R(t),t.addEventListener("keydown",e=>{V(e)?(e.preventDefault(),this.History.undo(e),this._clearKeydownState()):j(e)?(e.preventDefault(),this.History.redo(e),this._clearKeydownState()):this.AutoPairing.isInsert(e)?(e.preventDefault(),this.AutoPairing.insert(e),this.History.add(),this._clearKeydownState()):this.AutoPairing.isDelete(e)?(e.preventDefault(),this.AutoPairing.delete(e),this.History.add(),this._clearKeydownState()):this.Commentify.isValid(e)?(e.preventDefault(),this.Commentify.exec(e),this.History.add(),this._clearKeydownState()):this.Indentify.isValid(e)?(e.preventDefault(),this.Indentify.exec(e),this.History.add(),this._clearKeydownState()):["Meta","Control","Alt","Shift"].includes(e.key)||this._setKeydownState(e)}),t.addEventListener("keyup",e=>{let n=this._keydownState;if(this._clearKeydownState(),!n)return;if(n.value!==t.value)this.History.add(),this.AutoComplete.exec();else{let o=n.state,a=m(t);(o.short!==a.short||o.long!==a.long)&&this.History.add(!1)}}),this.element.addEventListener("mouseup",e=>{this.History.add(!1)})}getState(t){return m(this.element,t)}setState(t){y(this.element,t)}getCaretPosition(){return H(this.element)}_clearKeydownState(){this._keydownState=null}_setKeydownState(t){this._keydownState={value:this.element.value,state:m(this.element),key:t.key}}};return U(Y);})();
